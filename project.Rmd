---
title: "STAT 344 Group Project (Part I)"
author: "Lucas Qin, Frederick Wang, Isabel Wilson"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
options(scipen = 999)
```

# Reading in Data

``` {r warning=FALSE}

all_data_files = list.files("data")
all_df = read.csv(paste0("data/", all_data_files[1]))

for (i in 2 : length(all_data_files)) {
  all_df = rbind(all_df, read.csv(paste0("data/", all_data_files[i])))
}

filtered_df = all_df %>% filter(Section == "OVERALL") %>%
  mutate(CourseNum = ifelse(
    is.na(Detail), Course, paste0(Course, Detail)
  )) %>%
  select(-Campus, -Year, -Session, -Section, -Professor, -Course, -Detail)

filtered_df %>% slice(1:10)

N = nrow(filtered_df)
N

```
```{r}
histogram = hist(filtered_df$Avg)
```


Since we don't have access to the population standard deviation to guess the standard error of the sample we will be taking, we decided to use our personal transcript standard deviations to estimate the sample standard error. We found our transcript standard deviations to be around 7 percent, so we decided to guess the sample standard error to be 7 as well. 

```{r}
margin_of_error = 1 # desired width is 2%
sample_stdev_guess = 7 # intuitive guess since we don't have previous studies
n1 = (1/(margin_of_error^2/(qnorm(0.975)^2*sample_stdev_guess^2) + 1/N)) %>% ceiling()
n1 # minimum sample size for the mean

```

```{r}
margin_of_error = 0.05 # 2% width
conservative_squared_se = 0.5 * (1 - 0.5)
n2 = (1/(margin_of_error^2/(qnorm(0.975)^2*conservative_squared_se) + 1/N)) %>% ceiling()
n2 # minimum sample size for the proportion
```
```{r}
n = max(n1, n2) # final decided sample size
n
```

```{r}
set.seed(1)
srs = sample(filtered_df$Avg, n)
srs
```

SRS for mean:
```{r}
sample_mean = mean(srs); sample_mean
sample_se = sqrt((1-n/N)*sd(srs)^2/n); sample_se

ci_lb = sample_mean - qnorm(0.975)*sample_se
ci_ub = sample_mean + qnorm(0.975)*sample_se

conf_int = c(ci_lb, ci_ub)
c("Confidence Interval for Average UBC Grades Across All Classes in 2021", 
  "Winter Using Simple Random Sample", 
  conf_int)
```

SRS for proportion of grades above 90%:
```{r}
p_hat = length(srs[srs >= 90]) / n; p_hat
se_p_hat = sqrt((1 - n / N) * (p_hat * (1 - p_hat)) / n); se_p_hat

conf_int_p_hat = p_hat + c(-1, 1) * qnorm(0.975) * se_p_hat
c("Confidence Interval for Proportion of UBC Grades",
  "above 90% Across All Classes in 2021", 
  "Winter Using Simple Random Sample", 
  conf_int_p_hat)
```

Stratified sampling: 
```{r}


```



